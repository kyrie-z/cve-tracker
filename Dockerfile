FROM golang:1.15-buster AS builder

ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64\
    PROJECT=/go/src/cve-tracker

WORKDIR ${PROJECT}
COPY . .


RUN go env -w GOPROXY=https://goproxy.cn,direct \
    && make build


FROM  golang:1.15-buster

ENV PROJECT=/go/src/cve-tracker

COPY --from=builder ${PROJECT}/cve-tracker /

WORKDIR /

RUN mkdir /data

CMD ["/cve-tracker","-c", "/configs/config.yaml"]