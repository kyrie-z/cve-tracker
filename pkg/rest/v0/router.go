package v0

import (
	"net/http"

	"github.com/gin-gonic/gin"
)

func Router(addr string) error {
	var eng = gin.Default()
	v0 := eng.Group("v0")
	session := v0.Group("/session")
	{
		session.POST("login", login)
	}
	cves := v0.Group("/cves")
	{
		cves.GET("/:product", queryCVEList) //curl -X GET http://127.0.0.1:10808/v0/cves/v20?package=linu&status=unprocessed,fixed&count=3&debian_buster_status=open&score=5-4&sort=updated_at
		cves.PUT("/:product", updateCVE)    //curl -X PUT http://127.0.0.1:10808/v0/cves/v20 -H 'Content-Type:application/json' -d '{"cve":"CVE-2007-1614","package":"zziplib","status":"fixed"}'
	}

	tools := v0.Group("/tools")
	{
		tools.GET("/package/:product", queryPrepackageList)        //curl -X GET localhost:10808/v0/tools/package/v20
		tools.POST("/package/:product/:release", reloadPrepackage) //curl -X POST localhost:10808/v0/tools/package/v20/desktop -F 'packages=@./os'
	}

	return eng.Run(addr)
}

func login(c *gin.Context) {
	c.JSON(http.StatusOK, "login")
}
