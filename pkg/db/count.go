package db

//Query the number of vulnerabilities based on different query types and keywords
func QueryCount(sort, key, product string) int {
	db := getHandle(product)
	if db == nil {
		return 0
	}
	if sort == "kernel" || sort == "kernel_daily" {
		db = db.Table("kernel")
	} else {
		db = db.Table("cve")
	}
	var count int
	if sort == "high" {
		db.Where("score >= 7 and score <= 10 and status = ?", key).Count(&count)
	} else if sort == "medium" {
		db.Where("score >= 4 and score <= 6.9 and status = ?", key).Count(&count)
	} else if sort == "low" {
		db.Where("score >= 0 and score <= 3.9 and status = ?", key).Count(&count)
	} else if sort == "sys_daily" {
		db.Where("fix_at = ?", key).Count(&count)
	} else if sort == "kernel_daily" {
		db.Where("fix_at = ?", key).Count(&count)
	}

	return count
}
